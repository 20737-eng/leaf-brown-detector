<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Leaf Brown Scanner</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
<div class="container">

    <h2>ЁЯНГ р╕Хр╕гр╕зр╕Ир╕кр╕╡р╕Щр╣Йр╕│р╕Хр╕▓р╕ер╣Гр╕Щр╣Гр╕Ър╣Др╕бр╣Й</h2>

    <!-- input р╕Лр╣Ир╕нр╕Щ -->
    <input type="file" id="cameraInput" accept="image/*" capture="environment" style="display:none;">
    <input type="file" id="fileInput" accept="image/*" style="display:none;">

    <!-- р╕Ыр╕╕р╣Ир╕бр╣Бр╕вр╕Б -->
    <button onclick="openCamera()">ЁЯУ╖ р╕Цр╣Ир╕▓р╕вр╕ар╕▓р╕Юр╣Гр╕Ър╣Др╕бр╣Й</button>
    <button onclick="openGallery()" style="margin-top:10px;">ЁЯЦ╝ р╣Ар╕ер╕╖р╕нр╕Бр╕гр╕╣р╕Ыр╕Ир╕▓р╕Бр╣Ар╕Др╕гр╕╖р╣Ир╕нр╕З</button>

    <div id="result"></div>

</div>

<script>
function openCamera() {
    document.getElementById("cameraInput").click();
}

function openGallery() {
    document.getElementById("fileInput").click();
}

document.getElementById("cameraInput").addEventListener("change", function () {
    analyzeImage(this.files[0]);
});

document.getElementById("fileInput").addEventListener("change", function () {
    analyzeImage(this.files[0]);
});

function analyzeImage(file) {
    const result = document.getElementById("result");

    if (!file) return;

    const formData = new FormData();
    formData.append("image", file);

    result.innerHTML = "тП│ р╕Бр╕│р╕ер╕▒р╕Зр╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣М...";

    fetch("/analyze", {
        method: "POST",
        body: formData
    })
    .then(res => res.json())
    .then(data => {
        if (data.error) {
            result.innerHTML = "тЭМ " + data.error;
        } else {
            let percent = data.brown_percent;

            let level = "ЁЯЯв р╣Гр╕Ър╣Др╕бр╣Йр╕вр╕▒р╕Зр╣Ар╕Вр╕╡р╕вр╕з";
            if (percent > 20 && percent <= 50) level = "ЁЯЯб р╣Гр╕Ър╣Др╕бр╣Йр╣Ар╕гр╕┤р╣Ир╕бр╣Бр╕лр╣Йр╕З";
            if (percent > 50) level = "ЁЯФ┤ р╣Гр╕Ър╣Др╕бр╣Йр╣Бр╕лр╣Йр╕Зр╕бр╕▓р╕Б";

            result.innerHTML = `
                ЁЯЯд р╕кр╕╡р╕Щр╣Йр╕│р╕Хр╕▓р╕е: <b>${percent}%</b><br>
                р╕кр╕Цр╕▓р╕Щр╕░: <b>${level}</b>
            `;
        }
    })
    .catch(() => {
        result.innerHTML = "тЭМ р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Фр╣Гр╕Щр╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕н";
    });
}
</script>

</body>
</html>
